---
import { Image } from 'astro:assets';
import BaseLayout from './BaseLayout.astro';
import '@/styles/global.css';

interface Props {
  frontmatter: {
    cover: string;
    coverAlt: string;
    title: string;
    publishedDate: Date | string;
    readingTime: number;
    description: string;
  };
}

const { frontmatter } = Astro.props;

// Convert string date to Date object if needed (when using layout directly in frontmatter)
const publishedDate =
  typeof frontmatter.publishedDate === 'string'
    ? new Date(frontmatter.publishedDate)
    : frontmatter.publishedDate;

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/blog/*.{jpeg,jpg,png,gif}',
);

if (!images[frontmatter.cover]) {
  throw new Error(
    `"${frontmatter.cover}" does not exist in glob: "/src/assets/blog/*.{jpeg,jpg,png,gif}"`,
  );
}

const cover = images[frontmatter.cover]();
---

<BaseLayout>
  <section class="container mx-auto flex max-w-7xl flex-col gap-6 px-6 py-8">
    <h1 class="text-center text-4xl font-bold">{frontmatter.title}</h1>
    <p class="text-center text-sm text-gray-600">
      {
        publishedDate.toLocaleDateString('en-SG', {
          month: 'long',
          day: 'numeric',
          year: 'numeric',
        })
      }
    </p>
    <Image
      src={cover}
      alt={frontmatter.coverAlt}
      class="max-h-140 w-full rounded-lg object-cover shadow-md"
    />
    <div
      class="prose prose-img:rounded-lg prose-img:max-h-140 prose-img:w-auto prose-img:mx-auto prose-img:object-contain max-w-none"
    >
      <slot />
    </div>
  </section>
</BaseLayout>
